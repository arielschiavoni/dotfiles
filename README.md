# dotfiles

## Install

### Darwin (MacOS)

```bash
cd ./install/darwin/
./install.sh
```

### Linux

```bash
cd ./install/linux/
./install.sh
```

## Configure

The config script automatically detects the OS and creates the corresponding configuraiton for
the tools relevant to the OS. It uses `stow`.

```bash
cd ./config/
./config.sh
```

## Fish Shell Configuration

### Bundle System

Fish configuration uses a bundle system to pre-compile initialization code, dramatically improving shell startup time.

**How it works:**

1. `config.fish` checks for `~/.cache/fish/config_bundle.fish`
2. If the bundle exists, it's sourced (fast path: ~50ms)
3. If the bundle doesn't exist, `fish_bundle_rebuild` is called automatically to create it

**Directory Structure:**

```
~/.config/fish/
├── functions/
│   └── fish_bundle_rebuild.fish    # Rebuilds the bundle
├── bundle.d/                        # Static config (copied as-is into bundle)
│   ├── abbr.fish                   # Abbreviations
│   ├── env.fish                    # Environment variables
│   ├── keybindings.fish            # Key bindings
│   └── ...
├── conf.d/                          # Empty (kept empty to prevent duplication)
└── config.fish                      # Loads the cached bundle
```

**Build Process:**
The bundle is generated by running `fish_bundle_rebuild`, which:

1. Evaluates Homebrew environment (`brew shellenv`) - sets up PATH priorities
2. Captures initialization code from: fnm, zoxide, atuin, starship
3. Includes all static configuration files from `bundle.d/`
4. Writes everything to a single 20KB file

**Rebuild bundle after changes:**

```fish
fish_bundle_rebuild
```

**Performance:**
| Scenario | Time |
|----------|------|
| Normal startup (with bundle) | ~50ms |
| First startup (rebuilding bundle) | ~750ms |

Bundle provides **15x faster** startup compared to initial build.
